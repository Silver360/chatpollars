var myApp=angular.module("dollars",["ui.router"]);myApp.config(["$urlRouterProvider","$stateProvider","$locationProvider",function(a,b,c){b.state("prelogin",{url:"/prelogin",templateUrl:"views/prelogin.html",controller:"preLogin"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"login",resolve:{authentication:function(a){console.log("Zaraz sprawdze i przekieruje z Login"),a.init("login")}}}).state("chat",{url:"/chat",templateUrl:"views/chat.html",controller:"chat",resolve:{authentication:function(a){console.log("Zaraz sprawdze i przekieruje z Chat"),a.init("chat")}}}).state("otherwise",{url:"*path",resolve:{authentication:function(a){console.log("Zaraz sprawdze i przekieruje z Dowolnego"),a.init("otherwise")}}}),c.html5Mode(!0)}]);var app=angular.module("dollars");app.controller("chat",["$scope","$state","ServiceMessages",function(a,b,c){a.user="",a.msg={};var d=function(){c.getMessages()};a.sendMessage=function(b){c.sendMessage(b),a.message=""},a.$on("new:message",function(){a.msg=c.getMessage()}),a.deleteMessage=function(a){c.deleteMessage(a)},d()}]);var app=angular.module("dollars");app.controller("login",["$scope","serviceLogin","factoryAuthentication",function(a,b,c){a.auth={login:"",password:""},a.msg="",a.login=function(){b.login(a.auth)},a.$on("login:erorr",function(){a.msg=b.getError()}),a.confirm=function(){a.msg="",b.signin(a.auth)}}]);var app=angular.module("dollars");app.controller("preLogin",["$scope","$state","factoryAuthentication",function(a,b,c){a.appInit=function(){},a.testPass=function(){a.pass=null,a.enter=function(){"srallop"==a.pass&&b.go("login")}},a.appInit()}]);var app=angular.module("dollars");app.directive("back",function(a){function b(a,b,d){b.find(".back").click(function(){c()})}function c(){a.go("prelogin")}return{restrict:"A",link:b}}),app.directive("validate",function(){function a(a,b,c){b.find(".button").click(function(){var a=b.find("#main"),c=b.find("#wrong");a[0].pause(),c[0].play(),c.bind("ended",function(){a[0].play()})})}return{restrict:"A",link:a}});var app=angular.module("dollars");app.factory("factoryAuthentication",["socketio","$state","$location","$http","factoryUser",function(a,b,c,d,e){return{init:function(a){d.post("/authentication",{url:c.url()}).success(function(d){console.log("Autoryzacja"),"access:denied"==d.res?(console.log("Url: ",c.url()),"/login"!==a&&(console.log("go to login"),b.go("login"))):"access:go"==d.res?"chat"!==a&&(console.log("go to chat",c.url()),e.setUser(d.user),b.go("chat")):console.log("Wydarzylo sie cos nie spodziewanego ",d)}).error(function(a){console.log("Error przy autoryzacji: ".err)})}}}]);var app=angular.module("dollars");app.factory("socketio",function(a){var b=io.connect("http://localhost:4040");return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}});var app=angular.module("dollars");app.service("serviceLogin",["socketio","$rootScope","$state",function(a,b,c){var d={};a.on("login:res",function(a){"access"==a?c.go("chat"):(d=a,b.$broadcast("login:erorr"))}),this.login=function(b){a.emit("login",b)},this.getError=function(){return d},this.signin=function(b){a.emit("signin",b)}}]);var app=angular.module("dollars");app.service("ServiceMessages",["socketio","$rootScope",function(a,b){function c(a,b){for(var c=0;c<a.length;c++)if(-1!==a[c].indexOf(b))return a[c]}messages={},a.on("new:message",function(a){messages.push(a),b.$broadcast("new:message")}),a.on("new:messages",function(a){messages=a,b.$broadcast("new:message")}),this.sendMessage=function(b){a.emit("send:message",b)},this.getMessage=function(){return messages},this.getMessages=function(){a.emit("get:messages")},this.deleteMessage=function(b){console.log("Message ============= ",c(messages,b)),a.emit("delete:messages",c(messages,b),function(){})},Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}}]);var app=angular.module("dollars");app.factory("factoryUser",function(){return{user:{},setUser:function(a){console.log("User: ",a)},getUser:function(){return console.log("Uzytkownik: ",this.user),user}}});